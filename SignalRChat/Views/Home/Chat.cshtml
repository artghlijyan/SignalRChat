@model Chat

<div class="chat-body">
	@foreach (var message in Model.Messages)
	{
		<div class="message">
			<header>@message.Name:</header>
			<p>@message.Text</p>
			<footer>@message.TimeStamp</footer>
		</div>
	}
</div>

<form class="chat-input" asp-controller="Home" asp-action="CreateMessage">
	<input type="hidden" name="chatId" value="@Model.Id">
	<input type="text" name="message">
	<button type="submit">Send</button>
</form>

@section scripts
{
	<script src="~/js/signalr.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		var connection = new signarR.HubConnectionBuilder().withUrl("/chatHub").build();

		var _connectionId = ''

		connection.on("RecieveMessage", function (data) {
			colsole.log(data);
		})

		log(err)
			})

		var joinRoom = function () {
			var url = '/Chat/JoinRoom/' + _connectionId + '/@@Model.Name'
			axios.post(url, null)
				.then(res => {
					console.log("Room Joined", res)
				})
				.chatch(err => {
					console.log("Failed to Joined", err)
				})
		}

		connection.start()
			.then(function () {
				connection.Invoke('getConnectionId')
					.then(function (connectionId) {
						_connectionId = connectionId
						joinRoom()
					})
			})
			.catch(function (err) {
				console.


	</script>
}

